<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash-Deal | ëŒ€ìš©ëŸ‰ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ í”Œë«í¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #F8F9FA;
            color: #2D3748;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2D3748 0%, #1A202C 100%);
            color: white;
            padding: 24px 40px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #F97316 0%, #F59E0B 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .logo-text p {
            font-size: 13px;
            opacity: 0.8;
            font-weight: 400;
        }

        .header-status {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .status-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 40px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #E5E7EB;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 14px;
            color: #6B7280;
            font-weight: 500;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.redis {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        .stat-icon.server {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .stat-icon.stock {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .stat-description {
            font-size: 13px;
            color: #9CA3AF;
        }

        /* Main Card */
        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #E5E7EB;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #F3F4F6;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #1F2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-badge {
            padding: 6px 12px;
            background: #FEF3C7;
            color: #D97706;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Test Control */
        .test-control {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }

        .control-section {
            padding: 24px;
            background: #F9FAFB;
            border-radius: 12px;
            border: 2px dashed #E5E7EB;
        }

        .control-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #374151;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        .chart-container {
            background: #1F2937;
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #374151;
            max-height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chart-wrapper {
            position: relative;
            height: 250px;
            width: 100%;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .chart-badge.danger {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .chart-badge.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
        }

        .chart-result {
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            text-align: center;
        }

        .chart-result-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .chart-result-value.fail {
            color: #F87171;
        }

        .chart-result-value.success {
            color: #34D399;
        }

        .chart-result-label {
            font-size: 13px;
            color: #9CA3AF;
        }

        /* Progress Bar */
        .progress-container {
            margin: 24px 0;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #6B7280;
        }

        .progress-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10B981 0%, #059669 100%);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* Status Table */
        .status-table {
            margin-top: 24px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #E5E7EB;
        }

        .status-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .status-table th {
            background: #F3F4F6;
            padding: 14px 20px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-table td {
            padding: 16px 20px;
            border-top: 1px solid #E5E7EB;
            font-size: 14px;
        }

        .status-table tr:hover {
            background: #F9FAFB;
        }

        .value-highlight {
            font-weight: 600;
            color: #F97316;
        }

        /* Logs */
        .logs-container {
            background: #1F2937;
            border-radius: 12px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #9CA3AF;
            margin-right: 12px;
        }

        .log-message {
            color: #E5E7EB;
        }

        .log-message.success {
            color: #34D399;
        }

        .log-message.error {
            color: #F87171;
        }

        .log-message.warning {
            color: #FBBF24;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-left: 4px solid #F59E0B;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .info-box-title {
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box-content {
            color: #78350F;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #E5E7EB 0%, #F3F4F6 50%, #E5E7EB 100%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .test-control {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header {
                padding: 16px 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1000;
            border-left: 4px solid #10B981;
            min-width: 300px;
        }

        .toast.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-message {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1F2937;
        }

        .toast-text {
            font-size: 13px;
            color: #6B7280;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">âš¡</div>
                <div class="logo-text">
                    <h1>Flash-Deal</h1>
                    <p>ëŒ€ìš©ëŸ‰ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ í”Œë«í¼</p>
                </div>
            </div>
            <div class="header-status">
                <div class="status-badge">
                    <span class="status-dot"></span>
                    <span id="systemStatus">ì‹œìŠ¤í…œ í™œì„±</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Redis ìƒíƒœ</span>
                    <div class="stat-icon redis">ğŸ”´</div>
                </div>
                <div class="stat-value" id="redisStatus">ì—°ê²°ë¨</div>
                <div class="stat-description">ë¶„ì‚° ë½ ì¤€ë¹„ ì™„ë£Œ</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">ì„œë²„ ìƒíƒœ</span>
                    <div class="stat-icon server">âœ“</div>
                </div>
                <div class="stat-value" id="serverStatus">ì‘ë™ì¤‘</div>
                <div class="stat-description">Spring Boot 3.2.0</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">í˜„ì¬ ì¬ê³ </span>
                    <div class="stat-icon stock">ğŸ“¦</div>
                </div>
                <div class="stat-value" id="currentStock">-</div>
                <div class="stat-description" id="stockDescription">ì¿ í°ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ</div>
            </div>
        </div>

        <!-- Coupon Management Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ğŸ«</span>
                    ì¿ í° ê´€ë¦¬
                </h2>
                <span class="card-badge">ì„¤ì • í•„ìš”</span>
            </div>

            <div class="test-control">
                <div class="control-section">
                    <h3>1. í…ŒìŠ¤íŠ¸ ì¿ í° ìƒì„±</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="createCoupon()">
                            <span>+</span>
                            ì¿ í° ìƒì„± (ì¬ê³ : 100ê°œ)
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>2. ë‹¨ì¼ ë°œê¸‰ í…ŒìŠ¤íŠ¸</h3>
                    <div class="button-group">
                        <button class="btn btn-danger" onclick="issueCouponV1()" id="btnV1" disabled>
                            âš ï¸ V1 ë°œê¸‰
                        </button>
                        <button class="btn btn-success" onclick="issueCouponV2()" id="btnV2" disabled>
                            âœ“ V2 ë°œê¸‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- Status Table -->
            <div class="status-table" id="statusTable" style="display: none;">
                <table>
                    <thead>
                        <tr>
                            <th>ì†ì„±</th>
                            <th>ê°’</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ì¿ í° ID</td>
                            <td class="value-highlight" id="tableCouponId">-</td>
                            <td>ê³ ìœ  ì‹ë³„ì</td>
                        </tr>
                        <tr>
                            <td>ì¿ í°ëª…</td>
                            <td id="tableCouponName">-</td>
                            <td>í‘œì‹œ ì´ë¦„</td>
                        </tr>
                        <tr>
                            <td>ì „ì²´ ì¬ê³ </td>
                            <td class="value-highlight" id="tableTotalStock">-</td>
                            <td>ì´ˆê¸° ìˆ˜ëŸ‰</td>
                        </tr>
                        <tr>
                            <td>ë°œê¸‰ëœ ìˆ˜ëŸ‰</td>
                            <td class="value-highlight" id="tableIssuedCount">-</td>
                            <td>í˜„ì¬ ë°œê¸‰ëŸ‰</td>
                        </tr>
                        <tr>
                            <td>ë‚¨ì€ ì¬ê³ </td>
                            <td class="value-highlight" id="tableRemainingStock">-</td>
                            <td>ì‚¬ìš© ê°€ëŠ¥ ìˆ˜ëŸ‰</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Concurrency Test Dashboard -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ğŸ“Š</span>
                    ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ
                </h2>
                <span class="card-badge">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</span>
            </div>

            <div class="info-box">
                <div class="info-box-title">
                    <span>ğŸ’¡</span>
                    ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
                </div>
                <div class="info-box-content">
                    ì™„ì „í•œ ë©€í‹°ìŠ¤ë ˆë“œ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” 1,000ê°œì˜ ë™ì‹œ ìŠ¤ë ˆë“œë¡œ JUnit í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
                    ì•„ë˜ ì°¨íŠ¸ëŠ” V1 (Race Condition)ê³¼ V2 (ë¶„ì‚° ë½)ì˜ ì°¨ì´ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
                    <br><br>
                    <strong>ëª…ë ¹ì–´:</strong> <code
                        style="background: rgba(0,0,0,0.1); padding: 2px 8px; border-radius: 4px;">gradlew test --tests CouponConcurrencyTest</code>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <!-- V1 Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span>âš ï¸</span>
                            V1: ë½ ì—†ìŒ
                        </div>
                        <span class="chart-badge danger">Race Condition</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartV1"></canvas>
                    </div>
                    <div class="chart-result">
                        <div class="chart-result-value fail" id="resultV1">157ê°œ ë°œê¸‰</div>
                        <div class="chart-result-label">ì¬ê³  ì´ˆê³¼ ë°œìƒ ğŸ”´</div>
                    </div>
                </div>

                <!-- V2 Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span>âœ“</span>
                            V2: Redisson ë½
                        </div>
                        <span class="chart-badge success">ìŠ¤ë ˆë“œ ì•ˆì „</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartV2"></canvas>
                    </div>
                    <div class="chart-result">
                        <div class="chart-result-value success" id="resultV2">100ê°œ ë°œê¸‰</div>
                        <div class="chart-result-label">ì •í™•í•œ ì¬ê³  í†µì œ ğŸŸ¢</div>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-label">
                    <span>ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</span>
                    <span id="progressText">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Execution Logs -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ğŸ“</span>
                    ì‹¤í–‰ ë¡œê·¸
                </h2>
            </div>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry">
                    <span class="log-time">[00:00:00]</span>
                    <span class="log-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ. ì‚¬ìš©ì ì•¡ì…˜ ëŒ€ê¸° ì¤‘...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <div class="toast-icon" id="toastIcon">âœ“</div>
            <div class="toast-message">
                <div class="toast-title" id="toastTitle">ì„±ê³µ</div>
                <div class="toast-text" id="toastText">ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <script>
        let currentCouponId = null;
        let chartV1Instance = null;
        let chartV2Instance = null;

        // ì‹¤ì‹œê°„ ë°œê¸‰ ì¹´ìš´í„°
        let v1IssueCount = 0;
        let v2IssueCount = 0;

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initCharts() {
            const ctxV1 = document.getElementById('chartV1').getContext('2d');
            const ctxV2 = document.getElementById('chartV2').getContext('2d');

            // V1 ì°¨íŠ¸ ë°ì´í„° (Race Condition ì‹œë®¬ë ˆì´ì…˜ - ì´ˆë°˜ì€ ì •ìƒ, í›„ë°˜ ì¬ê³  ì´ˆê³¼)
            const dataV1 = {
                labels: ['0', '200', '400', '600', '800', '1000'],
                datasets: [{
                    label: 'ë°œê¸‰ëœ ìˆ˜ëŸ‰',
                    data: [0, 18, 42, 73, 112, 157],
                    borderColor: '#F97316',
                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                    tension: 0.3,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: '#F97316'
                }, {
                    label: 'ì¬ê³  í•œê³„ì„  (100ê°œ)',
                    data: [100, 100, 100, 100, 100, 100],
                    borderColor: '#EF4444',
                    borderDash: [8, 4],
                    borderWidth: 2,
                    tension: 0,
                    fill: false,
                    pointRadius: 0
                }]
            };

            // V2 ì°¨íŠ¸ ë°ì´í„° (ì•ˆì „í•œ êµ¬í˜„ - 100ê°œì—ì„œ ì •í™•íˆ ë©ˆì¶¤)
            const dataV2 = {
                labels: ['0', '200', '400', '600', '800', '1000'],
                datasets: [{
                    label: 'ë°œê¸‰ëœ ìˆ˜ëŸ‰',
                    data: [0, 19, 41, 65, 88, 100],
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.3,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: '#10B981'
                }, {
                    label: 'ì¬ê³  í•œê³„ì„  (100ê°œ)',
                    data: [100, 100, 100, 100, 100, 100],
                    borderColor: '#059669',
                    borderDash: [8, 4],
                    borderWidth: 2,
                    tension: 0,
                    fill: false,
                    pointRadius: 0
                }]
            };

            const config = {
                type: 'line',
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#E5E7EB',
                                font: { size: 11 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 180,
                            suggestedMax: 180,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9CA3AF',
                                stepSize: 20
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9CA3AF'
                            }
                        }
                    }
                }
            };

            chartV1Instance = new Chart(ctxV1, { ...config, data: dataV1 });
            chartV2Instance = new Chart(ctxV2, { ...config, data: dataV2 });
        }


        //  V1 ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateChartV1(count) {
            if (!chartV1Instance) return;
            chartV1Instance.data.labels.push(`${count}ê°œ`);
            chartV1Instance.data.datasets[0].data.push(count);
            chartV1Instance.data.datasets[1].data.push(100);
            if (chartV1Instance.data.labels.length > 15) {
                chartV1Instance.data.labels.shift();
                chartV1Instance.data.datasets[0].data.shift();
                chartV1Instance.data.datasets[1].data.shift();
            }
            chartV1Instance.update();
            document.getElementById('resultV1').textContent = `${count}ê°œ ë°œê¸‰`;
        }

        // V2 ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateChartV2(count) {
            if (!chartV2Instance) return;
            chartV2Instance.data.labels.push(`${count}ê°œ`);
            chartV2Instance.data.datasets[0].data.push(count);
            chartV2Instance.data.datasets[1].data.push(100);
            if (chartV2Instance.data.labels.length > 15) {
                chartV2Instance.data.labels.shift();
                chartV2Instance.data.datasets[0].data.shift();
                chartV2Instance.data.datasets[1].data.shift();
            }
            chartV2Instance.update();
            document.getElementById('resultV2').textContent = `${count}ê°œ ë°œê¸‰`;
        }

        // Add Log Entry
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logsContainer');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            let className = 'log-message';
            if (type === 'success') className += ' success';
            if (type === 'error') className += ' error';
            if (type === 'warning') className += ' warning';

            entry.innerHTML = `
                <span class="log-time">[${timestamp}]</span>
                <span class="${className}">${message}</span>
            `;

            logsContainer.appendChild(entry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // Show Toast
        function showToast(title, text, icon = 'âœ“') {
            const toast = document.getElementById('toast');
            document.getElementById('toastIcon').textContent = icon;
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastText').textContent = text;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ì¿ í° ìƒì„±
        async function createCoupon() {
            try {
                addLog('ì¬ê³  100ê°œë¡œ ìƒˆ ì¿ í° ìƒì„± ì¤‘...', 'info');
                const response = await fetch('/api/coupons?name=í…ŒìŠ¤íŠ¸ì¿ í°&stock=100', {
                    method: 'POST'
                });
                const data = await response.json();
                currentCouponId = data.id;

                document.getElementById('currentStock').textContent = data.availableStock;
                document.getElementById('stockDescription').textContent = 'í…ŒìŠ¤íŠ¸ ì‚¬ìš© ê°€ëŠ¥';

                // Enable buttons
                document.getElementById('btnV1').disabled = false;
                document.getElementById('btnV2').disabled = false;

                updateStatusTable(data);
                showToast('ì„±ê³µ', `ì¿ í° #${data.id} ìƒì„± ì™„ë£Œ`, 'ğŸ«');
                addLog(`âœ“ ì¿ í° ìƒì„±ë¨ | ID: ${data.id} | ì¬ê³ : ${data.availableStock}ê°œ`, 'success');
            } catch (error) {
                addLog(`âœ— ì¿ í° ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                showToast('ì˜¤ë¥˜', 'ì¿ í° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'âŒ');
            }
        }

        // Update Status Table
        function updateStatusTable(data) {
            document.getElementById('statusTable').style.display = 'block';
            document.getElementById('tableCouponId').textContent = data.id;
            document.getElementById('tableCouponName').textContent = data.name;
            document.getElementById('tableTotalStock').textContent = data.availableStock;
            document.getElementById('tableIssuedCount').textContent = data.issuedCount;
            document.getElementById('tableRemainingStock').textContent = data.remainingStock;
        }

        // Get Coupon Status
        async function getCouponStatus() {
            if (!currentCouponId) return;

            try {
                const response = await fetch(`/api/coupons/${currentCouponId}`);
                const data = await response.json();

                document.getElementById('currentStock').textContent = data.remainingStock;
                updateStatusTable(data);

                return data;
            } catch (error) {
                console.error('Failed to get status:', error);
            }
        }

        // V1 ì¿ í° ë°œê¸‰
        async function issueCouponV1() {
            if (!currentCouponId) {
                showToast('ê²½ê³ ', 'ë¨¼ì € ì¿ í°ì„ ìƒì„±í•˜ì„¸ìš”', 'âš ï¸');
                return;
            }

            try {
                addLog('V1ë¡œ ì¿ í° ë°œê¸‰ ì¤‘ (ë½ ì—†ìŒ)...', 'warning');
                const response = await fetch(`/api/coupons/${currentCouponId}/issue-v1`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    v1IssueCount++;
                    updateChartV1(data.issuedCount);
                    addLog(`âœ“ V1 ë°œê¸‰ ì„±ê³µ | ë‚¨ì€ ì¬ê³ : ${data.remainingStock}ê°œ`, 'success');
                    showToast('V1 ì„±ê³µ', `ë°œê¸‰ë¨! ë‚¨ì€ ì¬ê³ : ${data.remainingStock}ê°œ`, 'âš ï¸');
                } else {
                    addLog(`âœ— V1 ë°œê¸‰ ì‹¤íŒ¨ | ì¬ê³  ë¶€ì¡±`, 'error');
                    showToast('ì‹¤íŒ¨', 'ì¬ê³  ë¶€ì¡±', 'âŒ');
                }

                await getCouponStatus();
            } catch (error) {
                addLog(`âœ— V1 ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // V2 ì¿ í° ë°œê¸‰
        async function issueCouponV2() {
            if (!currentCouponId) {
                showToast('ê²½ê³ ', 'ë¨¼ì € ì¿ í°ì„ ìƒì„±í•˜ì„¸ìš”', 'âš ï¸');
                return;
            }

            try {
                addLog('V2ë¡œ ì¿ í° ë°œê¸‰ ì¤‘ (Redisson ë½)...', 'info');
                const response = await fetch(`/api/coupons/${currentCouponId}/issue-v2`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    v2IssueCount++;
                    updateChartV2(data.issuedCount);
                    addLog(`âœ“ V2 ë°œê¸‰ ì„±ê³µ | ë‚¨ì€ ì¬ê³ : ${data.remainingStock}ê°œ`, 'success');
                    showToast('V2 ì„±ê³µ', `ì•ˆì „í•˜ê²Œ ë°œê¸‰ë¨! ë‚¨ì€ ì¬ê³ : ${data.remainingStock}ê°œ`, 'âœ“');
                } else {
                    addLog(`âœ— V2 ë°œê¸‰ ì‹¤íŒ¨ | ì¬ê³  ë¶€ì¡±`, 'error');
                    showToast('ì‹¤íŒ¨', 'ì¬ê³  ë¶€ì¡±', 'âŒ');
                }

                await getCouponStatus();
            } catch (error) {
                addLog(`âœ— V2 ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            initCharts();
            addLog('âœ“ Flash-Deal í”Œë«í¼ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            addLog('Redis ì—°ê²° ì„¤ì •ë¨', 'success');
            addLog('ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ', 'info');
        });
    </script>
</body>

</html>